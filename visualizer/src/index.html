<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">

<!--Project dependencies
Leaflet
D3.js
Mapbox.com
-->





<head>

    <!-- <link rel="stylesheet" href="tabstyle.css"/> -->
    <link rel="stylesheet" href="pagestyle.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
          integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
          crossorigin=""/>


    <!--<link href='//mapbox.com/base/latest/base.css' rel='stylesheet' /> -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" type="text/javascript"></script>
    <script src="mapFunctions.js" type="text/javascript"></script>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script src="createChart.js" type="text/javascript"></script>
    <script src="http://d3js.org/d3.v4.min.js" type="text/javascript"></script>
    <script src="displayfunctions.js" type="text/javascript"></script>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>


</head>

<body>

<!--<h1>DNS Map</h1>-->


<!-- TAB FEATURES, WIP
<div class="tab">
    <button class="tablinks" onclick="openContent(event, 'MapWindow')">Map</button>
    <button class="tablinks" onclick="openMap(event, 'Statistics')">Statistics</button>
    <button class="tablinks" onclick="openContent(event, 'Test')">Test</button>
</div>


<div id="MapWindow" class="tabcontent">
    <div id="Map"></div>
    <script type="text/javascript">
        var queryMap = createMap();

    </script>
</div>

<div id="Statistics" class="tabcontent">
    <h3>Statistics</h3>
</div>

<div id="Test" class="tabcontent">
    <h3>Test</h3>
    <p>Test Content</p>
</div>
-->
<div id="Header" class="header"></div>

<div id="Map" class="leafletMap"></div>

<div id="searchBarContainer" class="mapMenu">
    <input type="text" name="mapSearch" placeholder="Search map..">
</div>

<div id="queryChartContainer" class="chart"></div>

<div id="sourceChartContainer" class="chart"></div>


<script type="text/javascript">
    // TODO Reformat with d3js
    // TODO Add multiple file support
    // TODO Add query display within timeframe
    // TODO Add graph for failed TLDs
    // TODO Add legend




    // config variables //
    var sourceFile = "../input/dnsVis0.csv";
    // config variables //

    d3.text(sourceFile, function(text) {    // read CSV file
        // config variables //
        var DNSServerLat = 43;
        var DNSServerLong = -77;
        // config variables //

        var data = d3.csvParseRows(text);
        var queryMarkers = [];
        var queryLines = [];

        // latLng object with DNS server coordinates
        var DNSServerCoords = L.latLng(DNSServerLat, DNSServerLong);

        // center of map
        var centerCoords = DNSServerCoords;

        // Create map
        var Map = L.map("Map", {zoomControl: false}).setView([0, 0], 2, {
            worldCopyJump: true
        });
        new L.Control.Zoom({position: 'topright' }).addTo(Map);
        // Retrieve map tile from mapbox
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
            '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© ' +
            '<a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 10,
            minZoom: 2,
            center: centerCoords,
            id: 'mapbox.dark',
            noWrap: false,
            accessToken: 'pk.eyJ1IjoiY2NoZXNsZXkyMzk3IiwiYSI6ImNqYTR4endzNTMxY2sycXFyemduaXIxM3EifQ.gvT6NeQ0Q6ykY8PVzMhTTw'
        }).addTo(Map);

        // Options for DNS server map marker
        var serverMarkerOptions = {
            radius: 13,
            fillColor: "#42e5f4",
            color: 'black',
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        };

        // Options for query source markers


        displayMapFeatures(Map, data, DNSServerCoords, queryMarkers, queryLines);

        var DNSServerCircle = L.circleMarker(DNSServerCoords, serverMarkerOptions).addTo(Map).bindPopup("DNS Server");


        var qChart = createQueryChart(data);    // create chart with frequency of each query
        var sChart = createSourceChart(data);   // create chart with frequency of each source IP
        Map.invalidateSize(true);               // resize map
    });
</script>








</body>

<script type="text/javascript">
    /*
    var headerData = [
        { "width":"100%", "height":"30px", "style":"fill:#2a2a2a" }
    ];
    var headerContainer = d3.select("#Header").append("svg")
        .attr("width",200)
        .attr("height",30);
    var header = headerContainer.append("rect")
        .attr("x",0)
        .attr("y",0)
        .attr("width", window.innerWidth)
        .attr("height", 100);
    */
</script>

</html>